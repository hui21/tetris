var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Uilt;!function(t){var e=function(){function t(){}return t}();e.debug=!0,e.panelLineWidth=2,e.panelLineColor=65280,t.Config=e,__reflect(e.prototype,"Uilt.Config");var i=function(){function t(){this.NowTimer=0,this.Timeer=10,this.Score=0}return t.prototype.getGameStatus=function(){return this.Status},t.prototype.setGameStatus=function(t){return this.Status=t},t.prototype.getNowTime=function(){return this.NowTimer},t.prototype.incNowTimeer=function(t){void 0===t&&(t=1),this.NowTimer+=t},t.prototype.getTime=function(){return this.Timeer},t.prototype.decTimeer=function(t){void 0===t&&(t=1),this.Timeer-=t},t.prototype.getScore=function(){return this.Score},t.prototype.decScore=function(t){void 0===t&&(t=1),this.Score-=t},t.prototype.incScore=function(t){void 0===t&&(t=1),this.Score+=t},t.prototype.restart=function(){this.Score=0,this.Status=h.Start,this.NowTimer=0},Object.defineProperty(t,"interval",{get:function(){return this._interval||(this._interval=new t)},enumerable:!0,configurable:!0}),t}();t.Game=i,__reflect(i.prototype,"Uilt.Game");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(egret.Sprite);t.Scene=r,__reflect(r.prototype,"Uilt.Scene");var n=function(){function t(){}return t.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},t.createLineTo=function(t,i,r,n,o,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=e.panelLineWidth),void 0===s&&(s=e.panelLineColor);var h=new egret.Shape;return h.graphics.lineStyle(o,s),h.graphics.moveTo(t,i),h.graphics.lineTo(r,n),h.graphics.endFill(),h},t.createCurveTo=function(t,i,r,n,o,s,h,a){void 0===t&&(t=0),void 0===i&&(i=0),void 0===h&&(h=e.panelLineWidth),void 0===a&&(a=e.panelLineColor);var u=new egret.Shape;return u.graphics.lineStyle(h,a),u.graphics.moveTo(t,i),u.graphics.curveTo(r,n,o,s),u.graphics.endFill(),u},t.drawBtn=function(t,e,i,r,n,o,s,h,a){void 0===a&&(a=!0);var u=new egret.Sprite,c=new egret.TextField;return u.addChild(c),u.x=t,u.y=e,u.graphics.beginFill(s),u.graphics.drawRoundRect(0,0,i,r,n,n),u.graphics.endFill(),u.touchEnabled=!0,c.y=15,c.width=i,c.height=r,c.text=o,c.textAlign="center",c.textColor=h,u},t}();t.Tool=n,__reflect(n.prototype,"Uilt.Tool");var o=function(){function t(){}return Object.defineProperty(t,"interval",{get:function(){return this.stage.width=640,this._interval||(this._interval=new t)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"stage",{get:function(){return egret.MainContext.instance.stage},enumerable:!0,configurable:!0}),Object.defineProperty(t,"stageW",{get:function(){return egret.MainContext.instance.stage.stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t,"stageH",{get:function(){return egret.MainContext.instance.stage.stageHeight},enumerable:!0,configurable:!0}),t}();t.Stage=o,__reflect(o.prototype,"Uilt.Stage");var s=function(){function t(){}return t.init=function(){this._propertyChange=Object.create(null),this._anchorChange=Object.create(null),this.injectAnchor()},t.setAnchorX=function(t,e){t.anchorX=e},t.setAnchorY=function(t,e){t.anchorY=e},t.setAnchor=function(t,e){t.anchorX=t.anchorY=e},t.getAnchor=function(t){return t.anchorX!=t.anchorY&&console.log("target's anchorX != anchorY"),t.anchorX||0},t.getAnchorY=function(t){return t.anchorY||0},t.getAnchorX=function(t){return t.anchorX||0},t.injectAnchor=function(){Object.defineProperty(egret.DisplayObject.prototype,"width",{get:function(){return this.$getWidth()},set:function(e){var i=this;this.$setWidth(e),t._propertyChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"height",{get:function(){return this.$getHeight()},set:function(e){var i=this;this.$setHeight(e),t._propertyChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorX",{get:function(){return this._anchorX},set:function(e){var i=this;this._anchorX=e,t._propertyChange[this.hashCode]=!0,t._anchorChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(i)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorY",{get:function(){return this._anchorY},set:function(e){var i=this;this._anchorY=e,t._propertyChange[this.hashCode]=!0,t._anchorChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(i)},this)},enumerable:!0,configurable:!0})},t.changeAnchor=function(t){this._propertyChange[t.hashCode]&&this._anchorChange[t.hashCode]&&(t.anchorOffsetX=t._anchorX*t.width,t.anchorOffsetY=t._anchorY*t.height,delete this._propertyChange[t.hashCode])},t}();t.AnchorUtils=s,__reflect(s.prototype,"Uilt.AnchorUtils");var h;!function(t){t[t.Load=0]="Load",t[t.Start=1]="Start",t[t.Stop=2]="Stop",t[t.Died=3]="Died",t[t.Finash=4]="Finash",t[t.OneFinash=5]="OneFinash"}(h=t.GameStatus||(t.GameStatus={}));var a;!function(t){t[t.x=1]="x",t[t.y=2]="y",t[t.both=3]="both"}(a=t.Coordinate||(t.Coordinate={}))}(Uilt||(Uilt={}));var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.stage.addChild(Play.Game.interval)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Play;!function(t){var e=Uilt.Stage,i=Uilt.Game,r=Uilt.GameStatus,n=Uilt.Tool,o=Uilt.AnchorUtils,s=function(t){function i(){var e=t.call(this)||this;return e.Init(),e}return __extends(i,t),Object.defineProperty(i,"interval",{get:function(){return this._interval||(this._interval=new i)},enumerable:!0,configurable:!0}),i.prototype.Init=function(){o.init();var t=new h;e.stage.addChild(t)},i.prototype.startBtnClickEvent=function(){this.startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.startBtnClickEvent,this),e.stage.removeChildren()},i}(egret.Sprite);t.Game=s,__reflect(s.prototype,"Play.Game");var h=function(t){function o(){var e=t.call(this)||this;return e.group=new egret.Sprite,e.gameName=new egret.Sprite,e.btnColor=14706956,e.btnRound=10,e.btnHeight=60,e.btnWidth=200,e.fontColor=16777215,e.init(),e}return __extends(o,t),o.prototype.init=function(){e.stage.addChild(p.interval),e.stage.addChild(c.interval),this.groupDraw(),this.gameNameDraw(),this.addChild(this.gameName),this.addChild(this.group);var t=(this.group.width-this.btnWidth)/2;this.startBtn=n.drawBtn(t,0,this.btnWidth,this.btnHeight,this.btnRound,"开始游戏",this.btnColor,this.fontColor),this.explainBtn=n.drawBtn(t,1*(this.btnHeight+20),this.btnWidth,this.btnHeight,this.btnRound,"操作介绍",this.btnColor,this.fontColor),this.settingBtn=n.drawBtn(t,2*(this.btnHeight+20),this.btnWidth,this.btnHeight,this.btnRound,"游戏设置",this.btnColor,this.fontColor),this.aboutBtn=n.drawBtn(t,3*(this.btnHeight+20),this.btnWidth,this.btnHeight,this.btnRound,"关于游戏",this.btnColor,this.fontColor),this.group.addChild(this.startBtn),this.group.addChild(this.aboutBtn),this.group.addChild(this.explainBtn),this.group.addChild(this.settingBtn),this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startBtnFunc,this),this.explainBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.explainBtnFunc,this),this.aboutBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.aboutBtnFunc,this),this.settingBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.settingBtnFunc,this)},o.prototype.settingBtnFunc=function(){var t="\r\n游戏设置\r\n游戏音效：你的扬声器有问题     \r\n游戏震动：你的操作系统不支持\r\n炫酷特效：快来资助我吧o_O??\r\n游戏难度：有点意思                  \r\n";this.textPanel(t)},o.prototype.gameNameDraw=function(){var t=new egret.TextField;this.gameName.width=e.stageW,this.gameName.y=-80,this.gameName.addChild(t),t.text="俄罗斯方块",t.width=this.gameName.width,t.textAlign="center",t.x=(e.stageW-this.gameName.width)/2,t.textColor=this.btnColor,t.fontFamily="楷体",t.size=80,egret.Tween.get(this.gameName).to({y:350},600,egret.Ease.backInOut).call(function(t){egret.Tween.removeTweens(t)},this,[this.gameName])},o.prototype.groupDraw=function(){this.group.width=400,this.group.height=300,this.group.alpha=0,this.group.x=(e.stageW-this.group.width)/2,this.group.y=(e.stageH-this.group.height)/1.5,this.group.graphics.drawRoundRect(0,0,this.group.width,this.group.height,10,10),this.group.graphics.endFill(),this.groupIn()},o.prototype.startBtnFunc=function(){e.stage.removeChild(this),i.interval.restart(),c.interval.restart(),y._interval=null,this.startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.startBtnFunc,this),e.stage.addChild(y.interval),y.interval.createRandOneCude(),i.interval.setGameStatus(r.Start)},o.prototype.explainBtnFunc=function(){var t="操作介绍\r\n\r\n键盘：上键旋转，下键快速下落，左右键左右移动，回车键暂停\r\n触屏：向上滑旋转，下滑快速下落，左右滑左右移动，双击暂停";this.textPanel(t)},o.prototype.aboutBtnFunc=function(){var t="关于游戏\r\n\r\n作者：听风              \r\nQQ：3123118153\r\n\r\n-----------------完成于2017年09月22日";this.textPanel(t)},o.prototype.textPanel=function(t){this.textGroup=new egret.Sprite;var i=new egret.TextField;this.textGroup.width=500,this.textGroup.height=400,this.textGroup.x=(e.stageW-this.textGroup.width)/2,this.textGroup.y=(e.stageH-this.textGroup.height)/1.6,this.textGroup.graphics.beginFill(3912946),this.textGroup.graphics.drawRoundRect(0,0,this.textGroup.width,this.textGroup.height,10,10),this.textGroup.graphics.endFill(),this.addChild(this.textGroup),i.width=this.textGroup.width,i.height=this.textGroup.height,i.lineSpacing=20,i.text=t,i.textAlign="center",i.textColor=16777215,this.textGroup.addChild(i),this.closeBtn=n.drawBtn(150,this.textGroup.height-70,this.btnWidth,this.btnHeight,this.btnRound,"关闭",this.btnColor,this.fontColor),this.textGroup.addChild(this.closeBtn),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeBtnFunc,this)},o.prototype.closeBtnFunc=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeBtnFunc,this),this.removeChild(this.textGroup)},o.prototype.groupOut=function(){egret.Tween.get(this.group).to({alpha:0},2e3,egret.Ease.backInOut).call(function(t){egret.Tween.removeTweens(t)},this,[this.group])},o.prototype.groupIn=function(){egret.Tween.get(this.group).to({alpha:1},2e3,egret.Ease.backInOut).call(function(t){egret.Tween.removeTweens(t)},this,[this.group])},o}(egret.Sprite);t.Menu=h,__reflect(h.prototype,"Play.Menu");var a=function(t){function o(){var e=t.call(this)||this;return e.group=new egret.Sprite,e.btnColor=14706956,e.btnRound=10,e.btnHeight=60,e.btnWidth=200,e.fontColor=16777215,e.init(),e}return __extends(o,t),o.prototype.init=function(){e.stage.addChild(p.interval),e.stage.addChild(c.interval),this.groupDraw(),this.addChild(this.group);var t=(this.group.width-this.btnWidth)/2;this.backGameBtn=n.drawBtn(t,20,this.btnWidth,this.btnHeight,this.btnRound,"继续游戏",this.btnColor,this.fontColor),this.restartBtn=n.drawBtn(t,1*(this.btnHeight+40),this.btnWidth,this.btnHeight,this.btnRound,"重新开始",this.btnColor,this.fontColor),this.backMenuBtn=n.drawBtn(t,2*(this.btnHeight+30),this.btnWidth,this.btnHeight,this.btnRound,"回到菜单",this.btnColor,this.fontColor),this.group.addChild(this.backGameBtn),this.group.addChild(this.restartBtn),this.group.addChild(this.backMenuBtn),this.backGameBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backGameBtnFunc,this),this.restartBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.restartBtnFunc,this),this.backMenuBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backMenuBtnFunc,this)},o.prototype.backGameBtnFunc=function(){this.backGameBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.backGameBtnFunc,this),e.stage.removeChild(this),y.interval.startTimer(),i.interval.setGameStatus(r.Start)},o.prototype.restartBtnFunc=function(){this.restartBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.restartBtnFunc,this),e.stage.removeChild(this),c.interval.restart(),i.interval.restart(),y.interval.removeTimer(),e.stage.removeChild(y.interval),y._interval=null,e.stage.addChild(y.interval),y.interval.createRandOneCude()},o.prototype.backMenuBtnFunc=function(){this.backMenuBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.backMenuBtnFunc,this),c.interval.restart(),y.interval.removeTimer(),e.stage.removeChild(y.interval),e.stage.removeChild(this),y._interval=null;var t=new h;e.stage.addChild(t)},o.prototype.groupDraw=function(){this.group.width=240,this.group.height=250,this.group.alpha=0,this.group.x=(e.stageW-this.group.width)/2,this.group.y=(e.stageH-this.group.height)/1.5,this.group.graphics.beginFill(3912946),this.group.graphics.drawRoundRect(0,0,this.group.width,this.group.height,10,10),this.group.graphics.endFill(),this.groupIn()},o.prototype.groupIn=function(){egret.Tween.get(this.group).to({alpha:1},2e3,egret.Ease.backInOut).call(function(t){egret.Tween.removeTweens(t)},this,[this.group])},o}(egret.Sprite);t.gameStop=a,__reflect(a.prototype,"Play.gameStop");var u=function(t){function r(){var i=t.call(this)||this;return i.maskMap=new egret.Shape,i.group=new egret.Sprite,i.width=e.stageW,i.height=e.stageH,i.init(),i}return __extends(r,t),r.prototype.init=function(){this.x=0,this.y=0,this.maskMap.graphics.beginFill(0),this.maskMap.graphics.drawRect(0,0,this.width,this.height),this.maskMap.graphics.endFill(),this.maskMap.alpha=.6,this.addChild(this.maskMap),this.group.width=400,this.group.height=400,this.group.alpha=0,this.group.x=(e.stageW-this.group.width)/2,this.group.y=(e.stageH-this.group.height)/2,this.group.graphics.beginFill(3912946),this.group.graphics.drawRoundRect(0,0,this.group.width,this.group.height,10,10),this.group.graphics.endFill(),this.addChild(this.group),this.restartBtn=n.drawBtn(100,this.group.height-170,200,60,10,"重新开始",14706956,16777215),this.group.addChild(this.restartBtn),this.restartBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.restartFunc,this),this.backMenuBtn=n.drawBtn(100,this.group.height-90,200,60,10,"返回菜单",14706956,16777215),this.group.addChild(this.backMenuBtn),this.backMenuBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backMenuBtnFunc,this);var t=new egret.TextField;t.y=60,t.width=this.group.width/2,t.text="分数",t.textAlign="center";var r=new egret.TextField;r.width=this.group.width/2,r.y=t.y+60,r.textAlign="center",r.text=String(i.interval.getScore()),this.group.addChild(t),this.group.addChild(r);var o=new egret.TextField;o.x=this.group.width/2,o.y=60,o.width=this.group.width/2,o.text="用时",o.textAlign="center";var s=new egret.TextField;s.x=this.group.width/2,s.y=o.y+60,s.width=this.group.width/2,s.textAlign="center",s.text=String(i.interval.getNowTime()),this.group.addChild(o),this.group.addChild(s),egret.Tween.get(this.group).to({alpha:1},1e3,egret.Ease.circOut).wait(600).to({x:this.group.x-10},50,egret.Ease.backInOut).to({x:this.group.x},50,egret.Ease.backInOut).to({x:this.group.x+10},50,egret.Ease.backInOut).to({x:this.group.x},50,egret.Ease.backInOut).call(function(t){egret.Tween.removeTweens(t)},this,[this.group])},r.prototype.restartFunc=function(t){this.restartBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.restartFunc,this),e.stage.removeChild(this),c.interval.restart(),i.interval.restart(),y.interval.removeTimer(),e.stage.removeChild(y.interval),y._interval=null,e.stage.addChild(y.interval),y.interval.createRandOneCude()},r.prototype.backMenuBtnFunc=function(t){this.backMenuBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.backMenuBtnFunc,this),e.stage.removeChild(this),c.interval.restart(),y.interval.removeTimer(),e.stage.removeChild(y.interval),y._interval=null;var i=new h;e.stage.addChild(i)},r}(egret.Sprite);t.gameOver=u,__reflect(u.prototype,"Play.gameOver");var c=function(t){function r(){var e=t.call(this)||this;return e.timerTitleText=new egret.TextField,e.timerText=new egret.TextField,e.scoreTitleText=new egret.TextField,e.scoreText=new egret.TextField,e.timeGroup=new egret.Sprite,e.scoreGroup=new egret.Sprite,e.init(),e}return __extends(r,t),Object.defineProperty(r,"interval",{get:function(){return this._interval||(this._interval=new r)},enumerable:!0,configurable:!0}),r.prototype.init=function(){this.width=e.stageW,this.height=p.topRow*p.gridSize,this.timeGroup.x=0,this.timeGroup.width=this.width/2,this.timeGroup.height=p.topRow*p.gridSize,this.scoreGroup.x=this.width/2,this.scoreGroup.width=this.width/2,this.scoreGroup.height=p.topRow*p.gridSize,this.addChild(this.timeGroup),this.addChild(this.scoreGroup),this.timerTitleText.width=this.timeGroup.width,this.timerTitleText.text="Timer: ",this.timerTitleText.textAlign="center",this.timeGroup.addChild(this.timerTitleText),this.timerText.y=p.gridSize,this.timerText.text="0",this.timerText.width=this.timerTitleText.width,this.timerText.textAlign="center",this.timeGroup.addChild(this.timerText),this.scoreTitleText.text="Score: ",this.scoreTitleText.width=this.scoreGroup.width,this.scoreTitleText.textAlign="center",this.scoreGroup.addChild(this.scoreTitleText),this.scoreText.y=p.gridSize,this.scoreText.text="0",this.scoreText.width=this.scoreTitleText.width,this.scoreText.textAlign="center",this.scoreGroup.addChild(this.scoreText)},Object.defineProperty(r.prototype,"score",{set:function(t){i.interval.incScore(t),this.scoreText.text=String(i.interval.getScore())},enumerable:!0,configurable:!0}),r.prototype.time=function(){i.interval.incNowTimeer(),this.timerText.text=String(i.interval.getNowTime())},r.prototype.restart=function(){this.timerText.text="0",this.scoreText.text="0"},r}(egret.Sprite);t.panel=c,__reflect(c.prototype,"Play.panel");var p=function(t){function i(){var r=t.call(this)||this;return r.gridMaps=[],r.width=i.gridItemCols*i.gridSize,r.height=e.stageH-1.8*i.gridSize,r.x=(e.stageW-i.gridItemCols*i.gridSize)/2,o.setAnchor(r,0),r.initGrid(),r}return __extends(i,t),Object.defineProperty(i,"interval",{get:function(){return this._interval||(this._interval=new i)},enumerable:!0,configurable:!0}),Object.defineProperty(i,"gridSize",{get:function(){return 63},enumerable:!0,configurable:!0}),Object.defineProperty(i,"gridItemCols",{get:function(){return 10},enumerable:!0,configurable:!0}),Object.defineProperty(i,"gridItemRows",{get:function(){return 16},enumerable:!0,configurable:!0}),Object.defineProperty(i,"topRow",{get:function(){return 2},enumerable:!0,configurable:!0}),i.prototype.initGrid=function(){this.y=i.gridSize*i.topRow;for(var t=0;t<=i.gridItemCols;t++){var e=new w(t*i.gridSize,0,0,this.height);this.addChild(e),this.gridMaps.push(new d(t,0))}for(var r=0;r<=i.gridItemRows;r++){var n=new w(0,r*i.gridSize,this.width,0);this.addChild(n),this.gridMaps.push(new d(0,r))}},i}(egret.Sprite);t.grid=p,__reflect(p.prototype,"Play.grid");var d=function(){function t(t,e,i){void 0===i&&(i=!0),this.x=t,this.y=e,this.isEmpty=i}return t}();t.gridMap=d,__reflect(d.prototype,"Play.gridMap");var g;!function(t){t[t.Type0=0]="Type0",t[t.Type1=1]="Type1",t[t.Type2=2]="Type2",t[t.Type3=3]="Type3",t[t.Type4=4]="Type4",t[t.Type5=5]="Type5",t[t.end=6]="end"}(g=t.cudeType||(t.cudeType={}));var l=function(t){function e(e,i,r,n){var s=t.call(this)||this;return s.color=10490641,s.sorce=1,s.posX=e,s.posY=i,s.x=y.posTo(e),s.y=y.posTo(i),o.setAnchor(s,.5),s.graphics.beginFill(s.color),s.graphics.drawRoundRect(0,0,r,n,10,10),s.graphics.endFill(),s}return __extends(e,t),Object.defineProperty(e,"cudeSize",{get:function(){return 62},enumerable:!0,configurable:!0}),e.prototype.isSelf=function(t){return this.hashCode===t},e}(egret.Sprite);t.cude=l,__reflect(l.prototype,"Play.cude");var v;!function(t){t[t.KeyLeft=37]="KeyLeft",t[t.KeyUp=38]="KeyUp",t[t.KeyRight=39]="KeyRight",t[t.KeyDown=40]="KeyDown",t[t.KeySpace=13]="KeySpace"}(v=t.KeyCode||(t.KeyCode={}));var f=function(){function t(t,e,i,r){this.x=t,this.y=e,this.posX=i,this.posY=r}return t}();t.cudePosXY=f,__reflect(f.prototype,"Play.cudePosXY");var y=function(t){function n(){var e=t.call(this)||this;return e.cudes=[],e.nowCude=[],e.nowSpeed=400,e.isMove=!0,e.canMove=!0,e.moveNewPosXy=[],e.isTouch=!1,e.touchX=0,e.touchY=0,e.touchTapCount=0,e.y=p.interval.y,e.x=p.interval.x,e.width=p.interval.width,e.height=p.interval.height,e.graphics.beginFill(0,0),e.graphics.drawRoundRect(0,0,e.width,e.height,10,10),e.graphics.endFill(),e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.touchBegin,e),e.addEventListener(egret.TouchEvent.TOUCH_END,e.touchEnd,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),window.addEventListener("keydown",function(t){switch(t.keyCode){case v.KeyLeft:e.KeyLeft();break;case v.KeyUp:e.KeyUp();break;case v.KeyRight:e.KeyRight();break;case v.KeyDown:e.KeyDown();break;case v.KeySpace:e.KeySpace()}},!1),e.speedTimer=new egret.Timer(e.nowSpeed,0),e.speedTimer.addEventListener(egret.TimerEvent.TIMER,e.speedTimerFunc,e),e.gameTimer=new egret.Timer(1e3,0),e.gameTimer.addEventListener(egret.TimerEvent.TIMER,e.gameTimerFunc,e),e.startTimer(),e}return __extends(n,t),Object.defineProperty(n,"interval",{get:function(){return this._interval||(this._interval=new n)},enumerable:!0,configurable:!0}),n.prototype.removeTimer=function(){this.speedTimer.removeEventListener(egret.TimerEvent.TIMER,this.speedTimerFunc,this),this.gameTimer.removeEventListener(egret.TimerEvent.TIMER,this.gameTimerFunc,this),this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.touchTap,this)},n.prototype.startTimer=function(){this.speedTimer.start(),this.gameTimer.start()},n.prototype.stopTimer=function(){this.speedTimer.stop(),this.gameTimer.stop()},n.prototype.touchBegin=function(t){this.isTouch=!0,this.touchX=t.localX,this.touchY=t.localY},n.prototype.touchEnd=function(t){var e=t.localX-this.touchX,i=t.localY-this.touchY;Math.abs(e)>Math.abs(i)?e>100?this.KeyRight():-100>e&&this.KeyLeft():i>100?this.KeyDown():-100>i&&this.KeyUp(),this.touchY=0,this.touchX=0,this.isTouch=!1},n.prototype.touchTap=function(t){var e=this;this.touchTapCount<1?this.touchTapCount++:this.KeySpace(),egret.setTimeout(function(){e.touchTapCount=0},this,500)},n.prototype.speedTimerFunc=function(){if(i.interval.getGameStatus()===r.Start)if(this.isMove)if(this.canDown()){this.resetCanMoveAndMoveNewPosXy();for(var t=0;t<this.nowCude.length;t++){var o=this.nowCude[t].posY+1;if(this.isOverGrid(o,v.KeyDown)){this.canMove=!1;break}var s=new f(0,0,this.nowCude[t].posX,o);this.moveNewPosXy.push(s)}this.pos(this.moveNewPosXy)}else{this.isMove=!1;for(var t=0;t<this.nowCude.length;t++)this.cudes.push(this.nowCude[t]);this.canDown()||this.remove()}else{if(this.isGameOVer()){this.stopTimer();var h=new u;return void e.stage.addChild(h)}n.interval.createRandOneCude(),this.isMove=!0}},n.prototype.nowCudeToCudes=function(){for(var t=0;t<this.nowCude.length;t++)this.cudes.push(this.nowCude[t])},n.prototype.isGameOVer=function(){var t=this.ArrSortAsc(this.cudes);return t[0].posY<=0?(i.interval.setGameStatus(r.Died),!0):!1},n.prototype.gameTimerFunc=function(){i.interval.getGameStatus()===r.Start&&(c.interval.time(),this.speedTimer.delay=this.nowSpeed-i.interval.getNowTime()/10)},n.prototype.canDown=function(){for(var t=!0,e=0;e<this.nowCude.length;e++)if(this.isOverGrid(this.nowCude[e].posY+1,v.KeyDown)||this.isPosXy(this.nowCude[e].posX,this.nowCude[e].posY+1)){t=!1;break}return t},n.prototype.resetCanMoveAndMoveNewPosXy=function(){this.canMove=!0,this.moveNewPosXy=[]},n.prototype.KeyUp=function(){if(i.interval.getGameStatus()===r.Start&&this.canDown()&&this.nowCudeType!==g.Type1&&this.nowCudeType!==g.Type0){for(var t=!0,e=[],n=0;n<this.nowCude.length;n++){var o=this.rotatePoint(this.nowCude[2],this.nowCude[n]);if(this.isOverGrid(o.posX-1,v.KeyLeft)||this.isOverGrid(o.posX+1,v.KeyRight)||this.isOverGrid(o.posY,v.KeyDown)){t=!1;break}e.push(o)}if(t)for(var n=0;n<this.nowCude.length;n++)this.nowCude[n].x=e[n].x,this.nowCude[n].y=e[n].y,this.nowCude[n].posX=e[n].posX,this.nowCude[n].posY=e[n].posY}},n.prototype.KeyDown=function(){if(i.interval.getGameStatus()===r.Start&&this.canDown()){for(var t=null,e=0;e<this.nowCude.length;e++){var o=this.downDiff(this.nowCude[e]);null===t?t=o:t>o&&(t=o)}for(var e=0;e<this.nowCude.length;e++){var s=t+this.nowCude[e].posY;this.nowCude[e].y=n.posTo(s),this.nowCude[e].posY=s}}},n.prototype.downDiff=function(t){if(this.cudes.length<1)return p.gridItemRows-1-t.posY;for(var e=this.ArrSortAsc(this.cudes),i=0;i<e.length;i++)if(e[i].posX===t.posX)return e[i].posY-t.posY-1;return p.gridItemRows-1-t.posY},n.prototype.KeyLeft=function(){if(i.interval.getGameStatus()===r.Start){this.resetCanMoveAndMoveNewPosXy();for(var t=0;t<this.nowCude.length&&this.canMove;t++){var e=this.nowCude[t].posX-1;if(this.isOverGrid(e,v.KeyLeft)||this.isPosXy(e,this.nowCude[t].posY)){this.canMove=!1;break}var n=new f(0,0,e,this.nowCude[t].posY);this.moveNewPosXy.push(n)}this.pos(this.moveNewPosXy)}},n.prototype.KeyRight=function(){if(i.interval.getGameStatus()===r.Start){this.resetCanMoveAndMoveNewPosXy();for(var t=0;t<this.nowCude.length&&this.canMove;t++){var e=this.nowCude[t].posX+1;if(this.isOverGrid(e,v.KeyRight)||this.isPosXy(e,this.nowCude[t].posY)){this.canMove=!1;break}var n=new f(0,0,e,this.nowCude[t].posY);this.moveNewPosXy.push(n)}this.pos(this.moveNewPosXy)}},n.prototype.isOverGrid=function(t,e){switch(void 0===e&&(e=v.KeyDown),e){case v.KeyDown:return t===p.gridItemRows;case v.KeyLeft:return-1===t;case v.KeyRight:return t===p.gridItemCols;default:return t===p.gridItemRows}},n.prototype.KeySpace=function(){if(i.interval.getGameStatus()===r.Start){this.stopTimer(),i.interval.setGameStatus(r.Stop);var t=new a;e.stage.addChild(t)}},n.prototype.isPosXy=function(t,e){for(var i=0;i<this.cudes.length;i++)if(this.cudes[i].posX===t&&this.cudes[i].posY===e)return!0;return!1},n.prototype.canRemove=function(t){for(var e=!0,i=0;i<p.gridItemCols;i++)if(!this.isPosXy(i,t)){e=!1;break}return e},n.prototype.remove=function(){for(var t=this,e=[],i=[],r=0,o=p.gridItemRows;o>0;o--)if(this.canRemove(o))for(var s=0;s<this.cudes.length;s++)if(this.cudes[s].posY==o){egret.Tween.removeTweens(this.cudes[s]);var h=egret.Tween.get(this.cudes[s]);h.to({scaleY:0,alpha:0},500,egret.Ease.backInOut).call(function(e){t.removeChild(e)},this,[this.cudes[s]]),e.push(this.cudes[s]),r+=this.cudes[s].sorce}else o>this.cudes[s].posY&&(this.inArray(this.cudes[s],i)||i.push(this.cudes[s]));if(e.length<1)return!1;c.interval.score=Math.floor(r+e.length/10);for(var s=0;s<e.length;s++){for(var a=0;a<i.length;a++)i[a].hashCode==e[s].hashCode&&i.splice(a,1);for(var a=0;a<this.cudes.length;a++)this.cudes[a].hashCode==e[s].hashCode&&this.cudes.splice(a,1)}for(var u=this.ArrSortDesc(i),s=0;s<u.length;s++){egret.Tween.removeTweens(u[s]);var d=this.moveCudePosYCount(u[s]),h=egret.Tween.get(u[s]);i[s].posY=d,h.to({y:n.posTo(d)},100).call(function(e,i){t.canRemove(i)&&t.remove()},this,[i[s],d])}return!0},n.prototype.inArray=function(t,e){for(var i=0;i<e.length;i++)if(t.hashCode===e[i].hashCode)return!0;return!1},n.prototype.moveCudePosYCount=function(t){for(var e=this.ArrSortAsc(this.cudes),i=0;i<e.length;i++)if(e[i].posY>t.posY&&e[i].posX===t.posX)return t.posY+Math.abs(e[i].posY-t.posY)-1;return p.gridItemRows-1},n.prototype.ArrSortAsc=function(t){for(var e=1;e<t.length;e++)for(var i=0;i<t.length-e;i++)if(t[i].posY>t[i+1].posY){var r=t[i];t[i]=t[i+1],t[i+1]=r}return t},n.prototype.ArrSortDesc=function(t){for(var e=1;e<t.length;e++)for(var i=0;i<t.length-e;i++)if(t[i].posY<t[i+1].posY){var r=t[i];t[i]=t[i+1],t[i+1]=r}return t},n.prototype.pos=function(t){if(this.canMove)for(var e=0;e<this.nowCude.length;e++){var i=n.posTo(t[e].posX),r=n.posTo(t[e].posY);egret.Tween.removeTweens(this.nowCude[e]),egret.Tween.get(this.nowCude[e]).to({x:i,y:r},15,egret.Ease.sineIn).set({posX:t[e].posX,posY:t[e].posY})}},n.posTo=function(t){return t*p.gridSize+1+p.gridSize/2},n.prototype.createRandOneCude=function(){this.nowCudeType=Math.round(Math.random()*g.end),this.nowCude=this.cudesEffect(this.nowCudeType);for(var t=0;t<this.nowCude.length;t++)this.addChild(this.nowCude[t])},n.prototype.cudesEffect=function(t){var e=[],i=Math.floor(p.gridItemCols/2),r=i-1;switch(t){case g.Type1:for(var n=r;i>=n;n++)for(var o=1;o>=0;o--)e.push(new l(n,o,l.cudeSize,l.cudeSize));break;case g.Type2:for(var o=2;o>=0;o--)for(var n=r;i>=n;n++)2>o&&n>r||e.push(new l(n,o,l.cudeSize,l.cudeSize));break;case g.Type3:for(var o=2;o>=0;o--)for(var n=r;i>=n;n++)1>o&&n>r||o>1&&i>n||e.push(new l(n,o,l.cudeSize,l.cudeSize));break;case g.Type4:for(var o=0;2>o;o++)1>o?e.push(new l(r,o,l.cudeSize,l.cudeSize)):(e.push(new l(r-1,o,l.cudeSize,l.cudeSize)),e.push(new l(r,o,l.cudeSize,l.cudeSize)),e.push(new l(i,o,l.cudeSize,l.cudeSize)));break;case g.Type5:for(var o=3;o>=0;o--)e.push(new l(r,o,l.cudeSize,l.cudeSize));break;default:for(var n=r;i>=n;n++)for(var o=1;o>=0;o--)e.push(new l(n,o,l.cudeSize,l.cudeSize))}return e},n.prototype.rotatePoint=function(t,e){var i=e.x-t.x+t.y,r=-e.y+t.x+t.y,n=-e.posY+t.posX+t.posY,o=e.posX-t.posX+t.posY;return new f(r,i,n,o)},n}(egret.Sprite);t.cudeData=y,__reflect(y.prototype,"Play.cudeData");var w=function(t){function e(e,i,r,n){var o=t.call(this)||this;return o.x=e,o.y=i,o.graphics.lineStyle(o.LineWidth,o.LineColor),o.graphics.moveTo(0,0),o.graphics.lineTo(r,n),o.graphics.endFill(),o}return __extends(e,t),Object.defineProperty(e.prototype,"LineColor",{get:function(){return 14737632},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"LineWidth",{get:function(){return 1},enumerable:!0,configurable:!0}),e}(egret.Shape);t.gridLine=w,__reflect(w.prototype,"Play.gridLine")}(Play||(Play={}));